<!DOCTYPE html>
<html lang="en">
<meta charset="utf-8">

<head>
  <title>HuTao GS documentation</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="../../css/style.css">
  <script src="../../js/jquery.js"></script>
  <script src="../js/sidebar.js" defer></script>
  <script src="../../js/closestAnchor.js" defer></script>
</head>

<body>
  <div class="content">
    <h1>Running</h1>
    <p class="tip important">Please complete the steps in <a href="./resources.html">Resources</a> before you continue.</p>
    <h2>Prerequisite</h2>
    <p><a href="https://github.com/openssl/openssl" target="_blank">openssl</a> (Or ask someone else to generate the certificates for you)</p>
    <p>You need patch Metadata (Only for 3.0.0 and lower versions) You can patch it with in-console command </p>
    <p class="tip"> You can join our discord server for more information about it! </p>
    <br>
    <br>
    <h2>Starting the server(Choose one)</h2>
    <h3>Starting development server</h3>
    <p>Start server by running <code>START-DEV.bat</code></p>
    <h3>Starting release server(webpack)</h3>
    <p>Start server by running <code>START-REL.bat</code></p>
    <h3>Starting release server(executable)</h3>
    <p>Start server by running <code>HuTao-GS.exe</code> (Located at <code>./dist</code> directory)</p>
    <br>
    <br>
    <h2>Stopping</h2>
    <p>Type <code>stop</code> in the server console then press enter to stop the server</p>
    <p class="tip important">If you did not use the <code>stop</code> command to stop the server, any unsaved data will be lost.</p>
    <br>
    <br>
    <h2>Connecting</h2>
    <p class="tip important">If you haven't already, do the steps listed on <a href="#a-install-ssl-certificate">Install SSL Certificate</a></p>
    <h3>Method 1: Fiddler</h3>
    <ol>
      <li><p>Download <a href="https://www.telerik.com/download/fiddler" target="_blank">Fiddler Classic</a> </p></li>
      <li><p>Open Fiddler and go <strong>tools -> options -> https and Open Capture Https Connect then also open decrypt https traffic and Ignore server certificate errors then click </strong> <code>Save Script</code> </p></li>
      <li><p>Then click <strong>ok</strong> </p></li>
      <li><p>Go to <strong>Fiddler Script</strong> then paste the script below into Fiddler Script </p></li>
      <code>/* Original script by NicknameGG, modified for Grasscutter by contributors, modified for HuTao GS by NotArandomGUY */
import System;
import System.Windows.Forms;
import Fiddler;
import System.Text.RegularExpressions;

class Handlers
{
    static function OnBeforeRequest(oS: Session) {
        if(oS.host.EndsWith(".yuanshen.com") || oS.host.EndsWith(".hoyoverse.com") || oS.host.EndsWith(".mihoyo.com") || oS.uriContains("http://overseauspider.yuanshen.com:8888/log")){
            oS.bypassGateway = true;
            oS["x-overrideHost"] = '127.0.0.1';
        }
    }
}</code>
    </ol>
    <h3>Method 2: DNS (Recommended)</h3>
    <ol>
      <li><p>Press <strong>Win+R</strong></p></li>
      <li><p>Type <code>ncpa.cpl</code></p></li>
      <li><p>Press enter</p></li>
      <li><p>Right click on your network adapter</p></li>
      <li><p>Select <strong>Properties</strong></p></li>
      <li><p>Inside <strong>This connection uses the following items</strong> select <strong>(TCP/IPv4)</strong> or <strong>(TCP/IPv6)</strong> depending on what you are using</p></li>
      <li><p>Click <strong>Properties</strong></p></li>
      <li><p>Select <strong>Use the following dns server addresses</strong></p></li>
      <li><p>Type the ip address in <code>hostIp</code> of <code>config.json</code> or <code>127.0.0.1</code> if hosting locally</p></li>
      <li><p>Press <strong>OK</strong></p></li>
      <li><p>(Optional but recommended) Run <code>ipconfig /flushdns</code></p></li>
      <li><p>Have fun!</p></li>
    </ol>
    <p class="tip important">Remember to switch back to <strong>Obtain dns server address automatically</strong> after you are done playing.</p>
    <br>
    <br>
    <h2>Install SSL Certificate</h2>
    <ol>
      <li><a href="#a-starting-the-server">Start the server</a></li>
      <li><p>Wait until certificates are generated</p></li>
      <li><p>Goto directory in <code>sslDir</code> of <code>config.json</code> or <code>./ssl</code> if you haven't changed it</p></li>
      <li><p>Open <code>ca.crt</code></p></li>
      <li><p>Click <strong>Install Certificate</strong></p></li>
      <li><p>Select <strong>Local Machine</strong></p></li>
      <li><p>Click <strong>Next</strong></p></li>
      <li><p>Click <strong>Yes</strong> if a prompt popped up</p></li>
      <li><p>Select <strong>Place all certificates in the following store</strong></p></li>
      <li><p>Click <strong>Browse</strong></p></li>
      <li><p>Select <strong>Trusted Root Certification Authorities</strong></p></li>
      <li><p>Click <strong>OK</strong></p></li>
      <li><p>Click <strong>Next</strong></p></li>
      <li><p>Click <strong>Finish</strong></p></li>
    </ol>
  </div>
</body>

</html>