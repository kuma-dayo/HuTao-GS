<!DOCTYPE html>
<html lang="cn">
<meta charset="utf-8">

<head>
  <title>HuTao GS 使用说明</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="../../css/style.css">
  <script src="../../js/jquery.js"></script>
  <script src="../js/sidebar.js" defer></script>
  <script src="../../js/closestAnchor.js" defer></script>
</head>

<body>
  <div class="content">
    <h1>运行服务端</h1>
    <p class="tip important">请先完成 <a href="./resources.html">Resources</a> 的步骤再继续。</p>
    <h2>运行条件</h2>
    <p>安装<a href="https://github.com/openssl/openssl" target="_blank">openssl</a>来生成证书 (或者让其他人给你生成)。</p>
    <p>你需要patch Metadata (只适用于3.0以及更低的版本。) 你可以使用控制台命令对其进行修补。 </p>
    <p class="tip"> 你可以加入我们的discord获取更多信息！ </p>
    <br>
    <br>
    <h2>开始(请选择你之前构建的版本)</h2>
    <h3>开发版服务端</h3>
    <p>运行 <code>START-DEV.bat</code></p>
    <h3>发行版服务端</h3>
    <p>运行 <code>START-REL.bat</code></p>
    <h3>发行版服务端(可执行文件)</h3>
    <p>运行 <code>HuTao-GS.exe</code> </p>
    <br>
    <br>
    <h2>停止</h2>
    <p>在服务器控制台中输入<code>stop</code>，然后按回车键停止服务器。</p>
    <p class="tip important">如果未使用该命令停止服务器，则任何未保存的数据都将丢失。</p>
    <br>
    <br>
    <h2>切换控制台显示语言</h2>
    <p>在服务器控制台中输入<code>gs set Language zh-cn</code>切换到简体中文</p>
    <p>在服务器控制台中输入<code>gs set Language zh-tw</code>切换到繁体中文</p>
    <br>
    <br>
    <h2>安装证书</h2>
    <ol>
      <li><p><strong>启动服务器</strong></p></li>
      <li><p>等待证书生成</p></li>
      <li><p>证书生成的目录为 <code>./ssl</code></p></li>
      <li><p>打开<code>ca.crt</code></p></li>
      <li><p>点击<strong>安装证书</strong></p></li>
      <li><p>选择<strong>本地计算机</strong></p></li>
      <li><p>点击<strong>下一步</strong></p></li>
      <li><p>如果弹出提示，点击<strong>是</strong></p></li>
      <li><p>选择<strong>本地计算机</strong></p></li>
      <li><p>点击<strong>浏览</strong></p></li>
      <li><p>选择<strong>受信任的根证书颁发机构</strong></p></li>
      <li><p>点击<strong>确定</strong></p></li>
      <li><p>点击<strong>下一步</strong></p></li>
      <li><p>点击<strong>完成</strong></p></li>
    </ol>
    <h2>连接</h2>
    <p class="tip important">如果尚未安装SSL证书，则请先安装SSL证书。</a></p>
    <h3>方法1：Fiddler（本项目代理脚本与GC不相同）</h3>
    <ol>
      <li><p>下载 <a href="https://www.telerik.com/download/fiddler" target="_blank">Fiddler Classic</a> </p></li>
      <li><p>打开 Fiddler接着打开上方的 <strong>tools -> options -> https </strong>并且打开Capture Https Connect 打开解密 https 流量并忽略服务器证书错误，然后点击<strong>保存脚本 </strong> </p></li>
      <li><p>点击<strong>确定</strong> </p></li>
      <li><p>然后打开<strong>Fiddler Script</strong>然后将下面的脚本粘贴到Fiddler Script里并保存脚本 </p></li>
      <code>/* Original script by NicknameGG, modified for Grasscutter by contributors, modified for HuTao GS by NotArandomGUY */
import System;
import System.Windows.Forms;
import Fiddler;
import System.Text.RegularExpressions;

class Handlers
{
    static function OnBeforeRequest(oS: Session) {
        if(oS.host.EndsWith(".yuanshen.com") || oS.host.EndsWith(".hoyoverse.com") || oS.host.EndsWith(".mihoyo.com") || oS.uriContains("http://overseauspider.yuanshen.com:8888/log")){
            oS.bypassGateway = true;
            oS["x-overrideHost"] = '127.0.0.1';
        }
    }
}</code>
    </ol>
    <h3>方法2：DNS (推荐)</h3>
    <ol>
      <li><p><strong>Win+R</strong></p></li>
      <li><p>输入<code>ncpa.cpl</code>回车</p></li>
      <li><p>右键你当前网络的网络适配器</p></li>
      <li><p>选择<strong>属性</strong></p></li>
      <li><p>在<strong>此连接使用下列项目中</strong> 选择<strong>(TCP/IPv4)</strong>或者<strong>(TCP/IPv6)</strong> 具体选择取决于你自己的使用</p></li>
      <li><p>点击<strong>属性</strong></p></li>
      <li><p>选择<strong>使用下面的 DNS 服务器地址</strong></p></li>
      <li><p>输入服务器IP地址，如果是本地则是<code>127.0.0.1</code></p></li>
      <li><p>点击<strong>确定</strong></p></li>
      <li><p>(可选，但建议使用)cmd输入<code>ipconfig /flushdns</code>刷新dns</p></li>
      <li><p>祝你玩的愉快！</p></li>
    </ol>
    <p class="tip important">游玩结束，关闭服务器后需要切换到<strong>自动获得DNS服务器地址</strong> </p>
    <br>
    <br>
    <p>是否阅读完毕? <a href="./Troubleshooting.html">常见问题</a></p>
  </div>
</body>

</html>
